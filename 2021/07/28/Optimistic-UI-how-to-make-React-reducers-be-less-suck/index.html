<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Optimistic UI: how to make React reducers be less suck | aredherring.tech</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Verbosity is not necessarily a bad thing, but sometimes it can feel annoying to write the same boilerplate over and over again. The following is a common pattern in React (or Redux) reducers, and is v">
<meta property="og:type" content="article">
<meta property="og:title" content="Optimistic UI: how to make React reducers be less suck">
<meta property="og:url" content="http://aredherring.tech/2021/07/28/Optimistic-UI-how-to-make-React-reducers-be-less-suck/index.html">
<meta property="og:site_name" content="aredherring.tech">
<meta property="og:description" content="Verbosity is not necessarily a bad thing, but sometimes it can feel annoying to write the same boilerplate over and over again. The following is a common pattern in React (or Redux) reducers, and is v">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://aredherring.tech/images/discord-badge.png">
<meta property="article:published_time" content="2021-07-28T18:00:00.000Z">
<meta property="article:modified_time" content="2021-12-12T08:35:48.389Z">
<meta property="article:author" content="Dan">
<meta property="article:tag" content="javascript">
<meta property="article:tag" content="react">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://aredherring.tech/images/discord-badge.png">
  
    <link rel="alternate" href="/atom.xml" title="aredherring.tech" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">aredherring.tech</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://aredherring.tech"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Optimistic-UI-how-to-make-React-reducers-be-less-suck" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/28/Optimistic-UI-how-to-make-React-reducers-be-less-suck/" class="article-date">
  <time class="dt-published" datetime="2021-07-28T18:00:00.000Z" itemprop="datePublished">2021-07-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Optimistic UI: how to make React reducers be less suck
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Verbosity is not necessarily a bad thing, but sometimes it can feel annoying to write the same boilerplate over and over again. The following is a common pattern in React (or Redux) reducers, and is very verbose:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [&#123;count, isActive, error&#125;, dispatch] = useReducer(</span><br><span class="line">  <span class="function">(<span class="params">state: StateType, action: ActionType</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">     <span class="keyword">case</span> <span class="string">&quot;LOADING&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;SET_SUCCESS&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        <span class="attr">count</span>: action.payload,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">error</span>: <span class="literal">null</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;SET_FAILURE&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          ...state,</span><br><span class="line">          <span class="attr">isActive</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">error</span>: action.payload,</span><br><span class="line">        &#125;;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  initialState</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> set = <span class="function">(<span class="params">amount: number</span>) =&gt;</span> &#123;</span><br><span class="line">  dispatch(&#123; <span class="attr">type</span>: <span class="string">&quot;LOADING&quot;</span> &#125;);</span><br><span class="line">  updateCounterOnServer(amount)</span><br><span class="line">    .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      dispatch(&#123; <span class="attr">type</span>: <span class="string">&quot;SET_SUCCESS&quot;</span>, <span class="attr">payload</span>: amount &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">      dispatch(&#123; <span class="attr">type</span>: <span class="string">&quot;SEt_FAILURE&quot;</span>, <span class="attr">payload</span>: error &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>It does the job, but aside from being verbose, it also has the problem that the user has to wait for a full round-trip to the server to confirm the transaction and also has you explicitly managing loading states. This is fine for mission-critical updates — such as when you’re submitting a destructive change.</p>
<p>Sometimes, though, you have either lower-sensitivity updates where you don’t care if the task doesn’t succeed or you have some other way of notifying the user and making it clear to them something is pending — such as how Discord displays pending messages:</p>
<p><img src="/images/discord-badge.png" alt="Displays a message being sent by Dan in Discord that is still in the pending state. Messages in the pending state are visibly distinguished from messages in the sent state by having a slightly darker colour to them"></p>
<p>If that’s the case, the following pattern might be more appropriate:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; data, pending, error &#125; = useReducer(<span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (‘payload’ <span class="keyword">in</span> action) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">data</span>: action.payload, <span class="attr">pending</span>: action.pending &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (‘error’ <span class="keyword">in</span> action) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; …state, error &#125;</span><br><span class="line">  &#125;  <span class="keyword">return</span> state</span><br><span class="line">&#125;, initialState);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> set = <span class="keyword">async</span> (amount) =&gt; &#123;</span><br><span class="line">  dispatch(&#123; <span class="attr">payload</span>: amount, <span class="attr">pending</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    dispatch(&#123; <span class="attr">payload</span>: <span class="keyword">await</span> updateCounterOnServer(amount), <span class="attr">pending</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    dispatch(&#123; <span class="attr">error</span>: e &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Note the changes:</p>
<ul>
<li>We don’t use a ‘type’ field but instead alter reducer behavior based on fields being present — The reason to use a type field in Redux is because every reducer in Redux receives every action, but in React reducers they’re narrowly scoped to a single component, usually</li>
<li>We immediately update the content with the potential value and mark it as pending, which can be displayed to the user.</li>
<li>It’s much more concise</li>
</ul>
<p>This provides snappier feedback to a user and also plays nicer with React’s transition API.</p>
<p>The key principle is that we assume the asynchronous operation is going to succeed and let the user have some indication of what it might result in while still letting them use the application. 9 times out of 10, our remote API server is going to work, so why are we always writing our state logic as if they will fail?</p>
<p>You <strong>should</strong> still handle failures in the UI, of course, but unless the pending task is a blocker to the user, there are nicer ways to structure your code than having boolean isLoading flags everywhere and waiting until the operation resolves before showing the user something more interesting than a spinner.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://aredherring.tech/2021/07/28/Optimistic-UI-how-to-make-React-reducers-be-less-suck/" data-id="ckx2zss4w0000i4onghxv8nac" data-title="Optimistic UI: how to make React reducers be less suck" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react/" rel="tag">react</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/10/06/Twitch-got-breached-Here-s-what-you-need-to-know/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Twitch got breached.
        
      </div>
    </a>
  
  
    <a href="/2021/06/05/What-s-a-Leak-anyway/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">What&#39;s a Leak anyway?</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/incidents/" rel="tag">incidents</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/psa/" rel="tag">psa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/" rel="tag">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/riot/" rel="tag">riot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/security/" rel="tag">security</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/incidents/" style="font-size: 10px;">incidents</a> <a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/psa/" style="font-size: 10px;">psa</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/riot/" style="font-size: 10px;">riot</a> <a href="/tags/security/" style="font-size: 20px;">security</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/12/05/Pay-Transparency/">Pay Transparency 2021</a>
          </li>
        
          <li>
            <a href="/2021/10/06/Twitch-got-breached-Here-s-what-you-need-to-know/">Twitch got breached.</a>
          </li>
        
          <li>
            <a href="/2021/07/28/Optimistic-UI-how-to-make-React-reducers-be-less-suck/">Optimistic UI: how to make React reducers be less suck</a>
          </li>
        
          <li>
            <a href="/2021/06/05/What-s-a-Leak-anyway/">What&#39;s a Leak anyway?</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 Dan<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>